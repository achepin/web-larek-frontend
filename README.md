# Проект "Веб-ларёк"

**Стек технологий:** HTML, SCSS, TypeScript, Webpack

---

## Описание проекта

Проект "Веб-ларёк" представляет собой интернет-магазин для веб-разработчиков. Цель проекта — предоставить пользователям возможность просматривать каталог товаров, добавлять товары в корзину и оформлять заказы.

### Особенности приложения

1. **Главная страница**:
   - Отображение каталога товаров.
   - Модальное окно с детальной информацией о товаре.
   - Возможность открыть корзину через иконку.

2. **Просмотр товара**:
   - Детальная информация о товаре.
   - Кнопка "Купить" для добавления товара в корзину.
   - Кнопка "Убрать" для удаления товара из корзины.

3. **Оформление заказа**:
   - Первый шаг: выбор способа оплаты и ввод адреса доставки.
   - Второй шаг: ввод контактных данных (почта, телефон) и подтверждение заказа.
   - Обработка ошибок при незаполненных полях.

4. **Общие требования**:
   - Модальные окна закрываются при клике за пределами окна или при нажатии кнопки «Закрыть».
   - Кнопки активируются только после выполнения необходимых действий.

---

## Структура проекта

```
src/ — исходные файлы проекта
src/components/ — папка с JS компонентами
src/components/base/ — папка с базовым кодом
```

### Важные файлы
- `src/pages/index.html` — HTML-файл главной страницы.
- `src/types/index.ts` — файл с типами TypeScript.
- `src/index.ts` — точка входа приложения.
- `src/scss/styles.scss` — корневой файл стилей.
- `src/utils/constants.ts` — файл с константами.
- `src/utils/utils.ts` — файл с утилитами.

---

## Установка и запуск

Для установки и запуска проекта выполните следующие команды:

```bash
npm install
npm run start
```

Или, если вы используете Yarn:

```bash
yarn
yarn start
```

---

## Сборка проекта

Для сборки проекта выполните:

```bash
npm run build
```

Или, если вы используете Yarn:

```bash
yarn build
```

---

## Архитектура проекта

### Базовый код

#### Классы и их функциональность

1. **Класс `EventEmitter`:**
   - Реализует паттерн "Наблюдатель".
   - Позволяет подписываться на события и уведомлять подписчиков о наступлении события.
   - Методы: `on`, `off`, `emit`.

2. **Класс `ProductModel`:**
   - Работает с данными о товарах.
   - Методы:
     - `fetchProducts`: Получает список товаров с сервера.
     - `getProductById`: Возвращает товар по его ID.

3. **Класс `CartModel`:**
   - Управляет состоянием корзины.
   - Методы:
     - `addToCart`: Добавляет товар в корзину.
     - `removeFromCart`: Удаляет товар из корзины.
     - `calculateTotalPrice`: Вычисляет общую стоимость товаров в корзине.

4. **Класс `OrderModel`:**
   - Управляет процессом оформления заказа.
   - Методы:
     - `validateAddress`: Проверяет валидность адреса.
     - `submitOrder`: Отправляет заказ на сервер.

---

### Типы данных

#### Типы для API

```typescript
export interface IProduct {
  id: string;
  name: string;
  price: number | null;
  description: string;
  category: string;
  image: string;
}

export interface ApiResponse {
  products: IProduct[];
}
```

#### Типы для моделей

```typescript
export interface CartItem {
  product: IProduct;
  quantity: number;
}

export interface CartState {
  items: CartItem[];
  totalPrice: number;
}
```

---

### Компоненты отображения

1. **Компонент `ProductCard`:**
   - Отображает карточку товара.
   - При нажатии на кнопку «Купить» генерируется событие `addToCart`.
   - Принимает шаблон карточки и обработчик клика как параметры.

2. **Компонент `Modal`:**
   - Универсальный контейнер для отображения различных контентов.
   - Закрывается при клике за пределами окна или на кнопку «Закрыть».
   - Соответствует HTML-элементу с `id="modal-container"`.

3. **Компонент `Cart`:**
   - Отображает содержимое корзины.
   - Подписывается на события:
     - `cart-change`: Генерируется моделью данных (`CartModel`) при изменении состояния корзины (например, при добавлении или удалении товара).
     - `cart-open`: Генерируется классом главной страницы (`MainPage`) при открытии модального окна корзины.

4. **Компонент `CheckoutForm`:**
   - Абстрактный класс для форм оформления заказа.
   - Содержит общие методы для работы с формами.
   - Имеет два дочерних класса:
     - `PaymentForm`: Форма с выбором способа оплаты и вводом адреса доставки.
     - `ContactForm`: Форма с контактными данными (почта, телефон).

5. **Компонент `OrderSuccessModal`:**
   - Отображает сообщение об успешном завершении создания заказа.
   - Подписывается на событие `order-success`, генерируемое моделью данных (`OrderModel`).

---

## UML-схема

![UML-диаграмма архитектуры](src/docs/UML.png)

------

### **Описание UML-схемы**

#### **1. Классы слоя Model**

Классы слоя Model отвечают за управление данными и бизнес-логикой приложения.

- **`EventEmitter`**
  Реализует паттерн "Наблюдатель". Позволяет классам подписываться на события и уведомлять подписчиков о наступлении событий.
  - Методы:
    - `on(event: string, callback: Function): void` — подписка на событие.
    - `off(event: string, callback: Function): void` — отписка от события.
    - `emit(event: string, data: any): void` — генерация события.
- **`ProductModel`**
  Управляет данными о товарах.
  - Методы:
    - `fetchProducts(): Promise<IProduct[]>` — получает список товаров с сервера.
    - `getProductById(id: string): IProduct | undefined` — возвращает товар по его ID.
- **`CartModel`**
  Управляет состоянием корзины.
  - Методы:
    - `addToCart(product: IProduct): void` — добавляет товар в корзину.
    - `removeFromCart(productId: string): void` — удаляет товар из корзины.
    - `calculateTotalPrice(): number` — вычисляет общую стоимость товаров в корзине.
- **`OrderModel`**
  Управляет процессом оформления заказа.
  - Методы:
    - `validateAddress(address: string): boolean` — проверяет валидность адреса.
    - `submitOrder(orderData: OrderData): Promise<void>` — отправляет заказ на сервер.

------

#### **2. Классы слоя View**

Классы слоя View отвечают за отображение данных пользователю.

- **`ProductCard`**
  Отображает карточку товара. При нажатии на кнопку "Купить" генерируется событие `addToCart`.

  - Методы:
    - `render(product: IProduct): HTMLElement` — создает HTML-элемент карточки товара.
    - `handleClick(): void` — обрабатывает клик по карточке товара.

- **`Modal`**
  Универсальный контейнер для модальных окон. Может отображать любой контент (например, информацию о товаре, корзину или форму оформления заказа).

  - Методы:
    - `open(content: HTMLElement): void` — открывает модальное окно с переданным контентом.
    - `close(): void` — закрывает модальное окно.

- **`Cart`**
  Отображает содержимое корзины. Подписывается на события `cart-change` и `cart-open`, чтобы обновлять и показывать корзину.

  - Методы:
    - `render(cartState: CartState): HTMLElement` — создает HTML-элемент корзины.
    - `update(cartState: CartState): void` — обновляет отображение корзины.

- **`CheckoutForm`** (абстрактный класс)
  Базовый класс для форм оформления заказа. Содержит общие методы для работы с формами.

  - Методы:

    - `render(): HTMLElement` — создает HTML-элемент формы.
    - `validate(): boolean` — проверяет валидность данных формы.

    

  - Подклассы:

    - **`PaymentForm`** — форма с выбором способа оплаты и вводом адреса доставки.
    - **`ContactForm`** — форма с контактными данными (почта, телефон).

- **`OrderSuccessModal`**
  Отображает сообщение об успешном завершении создания заказа. Подписывается на событие `order-success`.

  - Методы:
    - `show(): void` — показывает модальное окно с сообщением об успехе.

------

#### **3. Взаимодействие между классами**

Классы взаимодействуют через события, используя паттерн "Наблюдатель". Вот примеры таких взаимодействий:

1. **Добавление товара в корзину** :
   - Пользователь нажимает кнопку "Купить" на карточке товара (`ProductCard`).
   - Генерируется событие `addToCart` через `EventEmitter`.
   - Класс `CartModel` обрабатывает событие и обновляет состояние корзины.
   - После обновления состояния генерируется событие `cart-change`.
   - Класс `Cart` подписывается на событие `cart-change` и обновляет отображение корзины.
2. **Отображение корзины** :
   - Пользователь нажимает на иконку корзины на главной странице.
   - Класс главной страницы (`MainPage`) генерирует событие `cart-open`.
   - Класс `Cart` подписывается на это событие и открывает модальное окно с текущим содержимым корзины.
3. **Оформление заказа** :
   - Пользователь заполняет форму `PaymentForm` (способ оплаты и адрес доставки).
   - После успешной валидации происходит переход к форме `ContactForm` (контактные данные).
   - После подтверждения заказа модель данных (`OrderModel`) отправляет данные на сервер и генерирует событие `order-success`.
   - Класс `OrderSuccessModal` подписывается на это событие и отображает сообщение об успехе.

------

#### **4. Типы данных**

- **`IProduct`**
  Интерфейс для описания товара.

```typescript
  interface IProduct {

    id: string;

    name: string;

    price: number | null;

    description: string;

    category: string;

    image: string;
    
  }
```

- **`CartState`**
  Интерфейс для описания состояния корзины.

```typescript
  interface CartState {

    items: { product: IProduct; quantity: number }[];

    totalPrice: number;

  }
```

------

### **Цепочка взаимодействия (MVP)**

В терминах MVP каждую цепочку действий в проекте можно описать следующей последовательностью:
**V → P → M → P → V** , где:

- **V** — класс слоя View.
- **P** — метод презентера (например, `emit` из `EventEmitter`).
- **M** — класс слоя Model.

Пример:

1. Пользователь кликает по карточке товара (`V`).
2. Обработчик клика вызывает метод `emit` через `EventEmitter` (`P`).
3. Метод модели данных (`CartModel`) обрабатывает событие и обновляет состояние корзины (`M`).
4. После обновления состояния генерируется событие `cart-change` через `EventEmitter` (`P`).
5. Класс `Cart` подписывается на событие `cart-change` и обновляет отображение корзины (`V`).

---

## Архитектура проекта

В проекте используется архитектурный подход MVP (Model–View–Presenter), который помогает разделить ответственность между логикой и отображением.

- **Model** — содержит бизнес-логику и управляет данными.
- **View** — отвечает за отображение интерфейса пользователю.
- **Presenter** — связывает модель и представление, обрабатывает события и передаёт данные.

Такой подход позволяет:

- **Переиспользовать компоненты** без изменений (например, модальные окна, карточки товаров).
- **Расширять проект** без необходимости переписывать существующий код.
- **Изолировать компоненты**, чтобы они не взаимодействовали напрямую между собой, а только через `EventEmitter` и интерфейсы модели.

## Заключение

Проект "Веб-ларёк" реализует интернет-магазин для веб-разработчиков с использованием современных технологий и MVP-архитектуры. Все типы данных описаны в директории `src/types/`, а компоненты разделены на модели, представления и контроллеры.

Эта документация поможет вам разобраться в структуре проекта и продолжить его разработку.

